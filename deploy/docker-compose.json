version: '3'

############ Network ##############

networks:
  nia-daisy-chain:
    external: true

services:

  ############### MHS specific   ###################

  inbound:
    image: ${MHS_INBOUND_VERSION}
    networks:
      {"name":"",
"value": "${}"},nia-daisy-chain
    ports:
      {"name":"",
"value": "${}"},"${MHS_INBOUND_PORT}:443"
      {"name":"",
"value": "${}"},"8079:80"
      {"name":"",
"value": "${}"},"${MHS_INBOUND_HEALTHCHECK_SERVER_PORT}:${MHS_INBOUND_HEALTHCHECK_SERVER_PORT}"
    environment:
      {"name":"MHS_INBOUND_HEALTHCHECK_SERVER_PORT",
"value": "${MHS_INBOUND_HEALTHCHECK_SERVER_PORT}"},
      {"name":"MHS_LOG_LEVEL",
"value": "${MHS_LOG_LEVEL}"},
      {"name":"MHS_SECRET_PARTY_KEY",
"value": "${MHS_SECRET_PARTY_KEY}"},
      {"name":"MHS_SECRET_CLIENT_CERT",
"value": "${MHS_SECRET_CLIENT_CERT}"},
      {"name":"MHS_SECRET_CLIENT_KEY",
"value": "${MHS_SECRET_CLIENT_KEY}"},
      {"name":"MHS_SECRET_CA_CERTS",
"value": "${MHS_SECRET_CA_CERTS}"},
      {"name":"MHS_INBOUND_QUEUE_BROKERS",
"value": "${MHS_INBOUND_QUEUE_BROKERS}"},=${MHS_AMQP_BROKER}
      {"name":"MHS_INBOUND_QUEUE_NAME",
"value": "${MHS_INBOUND_QUEUE_NAME}"},=${MHS_QUEUE_NAME}
      {"name":"MHS_SECRET_INBOUND_QUEUE_USERNAME",
"value": "${MHS_SECRET_INBOUND_QUEUE_USERNAME}"},=${MHS_AMQP_USERNAME}
      {"name":"MHS_SECRET_INBOUND_QUEUE_PASSWORD",
"value": "${MHS_SECRET_INBOUND_QUEUE_PASSWORD}"},=${MHS_AMQP_PASSWORD}
      {"name":"MHS_STATE_TABLE_NAME",
"value": "${MHS_STATE_TABLE_NAME}"},
      {"name":"MHS_SYNC_ASYNC_STATE_TABLE_NAME",
"value": "${MHS_SYNC_ASYNC_STATE_TABLE_NAME}"},
      {"name":"MHS_DB_ENDPOINT_URL",
"value": "${MHS_DB_ENDPOINT_URL}"},
      {"name":"MHS_INBOUND_QUEUE_MESSAGE_TTL_IN_SECONDS",
"value": "${MHS_INBOUND_QUEUE_MESSAGE_TTL_IN_SECONDS}"},
      {"name":"AWS_ACCESS_KEY_ID",
"value": "${AWS_ACCESS_KEY_ID}"},
      {"name":"AWS_SECRET_ACCESS_KEY",
"value": "${AWS_SECRET_ACCESS_KEY}"},
      {"name":"MHS_INBOUND_USE_SSL",
"value": "${MHS_INBOUND_USE_SSL}"},
      {"name":"TCP_PORTS",
"value": "${TCP_PORTS}"},=${MHS_INBOUND_PORT}
      {"name":"SERVICE_PORTS",
"value": "${SERVICE_PORTS}"},=${MHS_INBOUND_SERVICE_PORTS}
      {"name":"SUPPORTED_FILE_TYPES",
"value": "${SUPPORTED_FILE_TYPES}"},

  outbound:
    image: ${MHS_OUTBOUND_VERSION}
    networks:
      {"name":"",
"value": "${}"},nia-daisy-chain
    ports:
      {"name":"",
"value": "${}"},"${MHS_OUTBOUND_PORT}:80"
    environment:
      {"name":"MHS_LOG_LEVEL",
"value": "${MHS_LOG_LEVEL}"},
      {"name":"MHS_SECRET_PARTY_KEY",
"value": "${MHS_SECRET_PARTY_KEY}"},
      {"name":"MHS_SECRET_CLIENT_CERT",
"value": "${MHS_SECRET_CLIENT_CERT}"},
      {"name":"MHS_SECRET_CLIENT_KEY",
"value": "${MHS_SECRET_CLIENT_KEY}"},
      {"name":"MHS_SECRET_CA_CERTS",
"value": "${MHS_SECRET_CA_CERTS}"},
      {"name":"MHS_STATE_TABLE_NAME",
"value": "${MHS_STATE_TABLE_NAME}"},
      {"name":"MHS_DB_ENDPOINT_URL",
"value": "${MHS_DB_ENDPOINT_URL}"},
      {"name":"MHS_SYNC_ASYNC_STATE_TABLE_NAME",
"value": "${MHS_SYNC_ASYNC_STATE_TABLE_NAME}"},
      {"name":"AWS_ACCESS_KEY_ID",
"value": "${AWS_ACCESS_KEY_ID}"},
      {"name":"AWS_SECRET_ACCESS_KEY",
"value": "${AWS_SECRET_ACCESS_KEY}"},
      {"name":"MHS_RESYNC_INTERVAL",
"value": "${MHS_RESYNC_INTERVAL}"},
      {"name":"MAX_RESYNC_RETRIES",
"value": "${MAX_RESYNC_RETRIES}"},
      {"name":"MHS_SPINE_ROUTE_LOOKUP_URL",
"value": "${MHS_SPINE_ROUTE_LOOKUP_URL}"},
      {"name":"MHS_SPINE_ORG_CODE",
"value": "${MHS_SPINE_ORG_CODE}"},
      {"name":"MHS_SPINE_REQUEST_MAX_SIZE",
"value": "${MHS_SPINE_REQUEST_MAX_SIZE}"},
      {"name":"MHS_FORWARD_RELIABLE_ENDPOINT_URL",
"value": "${MHS_FORWARD_RELIABLE_ENDPOINT_URL}"},
      {"name":"MHS_OUTBOUND_VALIDATE_CERTIFICATE",
"value": "${MHS_OUTBOUND_VALIDATE_CERTIFICATE}"},
      {"name":"SERVICE_PORTS",
"value": "${SERVICE_PORTS}"},
      {"name":"MHS_OUTBOUND_ROUTING_LOOKUP_METHOD",
"value": "${MHS_OUTBOUND_ROUTING_LOOKUP_METHOD}"},
      {"name":"MHS_SDS_API_URL",
"value": "${MHS_SDS_API_URL}"},
      {"name":"MHS_SDS_API_KEY",
"value": "${MHS_SDS_API_KEY}"},
      {"name":"SUPPORTED_FILE_TYPES",
"value": "${SUPPORTED_FILE_TYPES}"},

  ########### PS Adapter Specific ###############

  gpc_facade:
    image: ${PS_FACADE_VERSION}
    ports:
      {"name":"",
"value": "${}"},"8081:8081"
    depends_on:
      {"name":"",
"value": "${}"},ps_db
    environment:
      {"name":"GPC_FACADE_SERVER_PORT",
"value": "${GPC_FACADE_SERVER_PORT}"},
      {"name":"PS_DB_URL",
"value": "${PS_DB_URL}"},
      {"name":"GPC_FACADE_USER_DB_PASSWORD",
"value": "${GPC_FACADE_USER_DB_PASSWORD}"},
      {"name":"PS_AMQP_BROKER",
"value": "${PS_AMQP_BROKER}"},
      {"name":"PS_QUEUE_NAME",
"value": "${PS_QUEUE_NAME}"},
      {"name":"PS_AMQP_USERNAME",
"value": "${PS_AMQP_USERNAME}"},
      {"name":"PS_AMQP_PASSWORD",
"value": "${PS_AMQP_PASSWORD}"},
      {"name":"PS_AMQP_MAX_REDELIVERIES",
"value": "${PS_AMQP_MAX_REDELIVERIES}"},
      {"name":"PS_LOGGING_LEVEL",
"value": "${PS_LOGGING_LEVEL}"},
    networks:
      {"name":"",
"value": "${}"},nia-daisy-chain

  ps_gp2gp_translator:
    image: ${PS_TRANSLATOR_VERSION}
    ports:
      {"name":"",
"value": "${}"},"8085:8085"
    depends_on:
      {"name":"",
"value": "${}"},ps_db
    environment:
      {"name":"GP2GP_TRANSLATOR_SERVER_PORT",
"value": "${GP2GP_TRANSLATOR_SERVER_PORT}"},
      {"name":"PS_DB_URL",
"value": "${PS_DB_URL}"},
      {"name":"GP2GP_TRANSLATOR_USER_DB_PASSWORD",
"value": "${GP2GP_TRANSLATOR_USER_DB_PASSWORD}"},
      {"name":"PS_AMQP_BROKER",
"value": "${PS_AMQP_BROKER}"},
      {"name":"MHS_AMQP_BROKER",
"value": "${MHS_AMQP_BROKER}"},
      {"name":"PS_QUEUE_NAME",
"value": "${PS_QUEUE_NAME}"},
      {"name":"MHS_QUEUE_NAME",
"value": "${MHS_QUEUE_NAME}"},
      {"name":"PS_AMQP_USERNAME",
"value": "${PS_AMQP_USERNAME}"},
      {"name":"PS_AMQP_PASSWORD",
"value": "${PS_AMQP_PASSWORD}"},
      {"name":"PS_AMQP_MAX_REDELIVERIES",
"value": "${PS_AMQP_MAX_REDELIVERIES}"},
      {"name":"MHS_AMQP_USERNAME",
"value": "${MHS_AMQP_USERNAME}"},
      {"name":"MHS_AMQP_PASSWORD",
"value": "${MHS_AMQP_PASSWORD}"},
      {"name":"MHS_AMQP_MAX_REDELIVERIES",
"value": "${MHS_AMQP_MAX_REDELIVERIES}"},
      {"name":"MHS_BASE_URL",
"value": "${MHS_BASE_URL}"},
      {"name":"PS_LOGGING_LEVEL",
"value": "${PS_LOGGING_LEVEL}"},
      {"name":"SUPPORTED_FILE_TYPES",
"value": "${SUPPORTED_FILE_TYPES}"},
      {"name":"STORAGE_TYPE",
"value": "${STORAGE_TYPE}"},
      {"name":"STORAGE_REGION",
"value": "${STORAGE_REGION}"},
      {"name":"STORAGE_CONTAINER_NAME",
"value": "${STORAGE_CONTAINER_NAME}"},
      {"name":"STORAGE_REFERENCE",
"value": "${STORAGE_REFERENCE}"},
      {"name":"STORAGE_SECRET",
"value": "${STORAGE_SECRET}"},
      {"name":"PS_DAISY_CHAINING_ACTIVE",
"value": "${PS_DAISY_CHAINING_ACTIVE}"},
      {"name":"GP2GP_MHS_INBOUND_QUEUE",
"value": "${GP2GP_MHS_INBOUND_QUEUE}"},
      {"name":"GP2GP_AMQP_BROKERS",
"value": "${GP2GP_AMQP_BROKERS}"},
      {"name":"GP2GP_AMQP_USERNAME",
"value": "${GP2GP_AMQP_USERNAME}"},
      {"name":"GP2GP_AMQP_PASSWORD",
"value": "${GP2GP_AMQP_PASSWORD}"},
    networks:
      {"name":"",
"value": "${}"},nia-daisy-chain

  ps_db:
    image: ${POSTGRES_VERSION}
    ports:
      {"name":"",
"value": "${}"},"${PS_DB_PORT}:5432"
    environment:
      {"name":"POSTGRES_PASSWORD",
"value": "${POSTGRES_PASSWORD}"},
      {"name":"PS_DB_OWNER_NAME",
"value": "${PS_DB_OWNER_NAME}"},
    networks:
      {"name":"",
"value": "${}"},nia-daisy-chain

  db_migration:
    image: ${PS_DB_MIGRATION_VERSION}
    depends_on:
      {"name":"",
"value": "${}"},ps_db
    environment:
      {"name":"POSTGRES_PASSWORD",
"value": "${POSTGRES_PASSWORD}"},
      {"name":"PS_DB_OWNER_NAME",
"value": "${PS_DB_OWNER_NAME}"},
      {"name":"PS_DB_URL",
"value": "${PS_DB_URL}"},
      {"name":"GPC_FACADE_USER_DB_PASSWORD",
"value": "${GPC_FACADE_USER_DB_PASSWORD}"},
      {"name":"GP2GP_TRANSLATOR_USER_DB_PASSWORD",
"value": "${GP2GP_TRANSLATOR_USER_DB_PASSWORD}"},
    networks:
      {"name":"",
"value": "${}"},nia-daisy-chain

  ########### GP2GP Adapter Specific ###############

  gp2gp:
    image: ${GP2GP_ADAPTOR_VERSION}
    networks:
      {"name":"",
"value": "${}"},nia-daisy-chain
    depends_on:
      {"name":"",
"value": "${}"},mongodb
      {"name":"",
"value": "${}"},activemq
    ports:
      {"name":"",
"value": "${}"},"${GP2GP_SERVER_PORT}:8183"
    environment:
      {"name":"GP2GP_SERVER_PORT",
"value": "${GP2GP_SERVER_PORT}"},
      {"name":"GP2GP_LOGGING_LEVEL",
"value": "${GP2GP_LOGGING_LEVEL}"},
      {"name":"GP2GP_AMQP_BROKERS",
"value": "${GP2GP_AMQP_BROKERS}"},
      {"name":"GP2GP_AMQP_USERNAME",
"value": "${GP2GP_AMQP_USERNAME}"},
      {"name":"GP2GP_AMQP_PASSWORD",
"value": "${GP2GP_AMQP_PASSWORD}"},
      {"name":"GP2GP_AMQP_MAX_REDELIVERIES",
"value": "${GP2GP_AMQP_MAX_REDELIVERIES}"},
      {"name":"GP2GP_MONGO_URI",
"value": "${GP2GP_MONGO_URI}"},
      {"name":"GP2GP_MONGO_DATABASE_NAME",
"value": "${GP2GP_MONGO_DATABASE_NAME}"},
      {"name":"GP2GP_MONGO_TTL",
"value": "${GP2GP_MONGO_TTL}"},
      {"name":"GP2GP_COSMOS_DB_ENABLED",
"value": "${GP2GP_COSMOS_DB_ENABLED}"},
      {"name":"GP2GP_STORAGE_TYPE",
"value": "${GP2GP_STORAGE_TYPE}"},
      {"name":"GP2GP_STORAGE_CONTAINER_NAME",
"value": "${GP2GP_STORAGE_CONTAINER_NAME}"},
      {"name":"GP2GP_MHS_OUTBOUND_URL",
"value": "${GP2GP_MHS_OUTBOUND_URL}"},
      {"name":"AZURE_STORAGE_CONNECTION_STRING",
"value": "${AZURE_STORAGE_CONNECTION_STRING}"},
      {"name":"AWS_ACCESS_KEY_ID",
"value": "${AWS_ACCESS_KEY_ID}"},
      {"name":"AWS_SECRET_ACCESS_KEY",
"value": "${AWS_SECRET_ACCESS_KEY}"},
      {"name":"AWS_REGION",
"value": "${AWS_REGION}"},
      {"name":"GP2GP_GPC_GET_URL",
"value": "${GP2GP_GPC_GET_URL}"},
      {"name":"GP2GP_GPC_DOCUMENTS_FHIR_BASE",
"value": "${GP2GP_GPC_DOCUMENTS_FHIR_BASE}"},
      {"name":"GP2GP_GPC_STRUCTURED_FHIR_BASE",
"value": "${GP2GP_GPC_STRUCTURED_FHIR_BASE}"},
      {"name":"GP2GP_SSL_TRUST_STORE_URL",
"value": "${GP2GP_SSL_TRUST_STORE_URL}"},
      {"name":"GP2GP_SSL_TRUST_STORE_PASSWORD",
"value": "${GP2GP_SSL_TRUST_STORE_PASSWORD}"},
      {"name":"GP2GP_GPC_OVERRIDE_NHS_NUMBER",
"value": "${GP2GP_GPC_OVERRIDE_NHS_NUMBER}"},
      {"name":"GP2GP_GPC_OVERRIDE_FROM_ASID",
"value": "${GP2GP_GPC_OVERRIDE_FROM_ASID}"},
      {"name":"GP2GP_GPC_OVERRIDE_TO_ASID",
"value": "${GP2GP_GPC_OVERRIDE_TO_ASID}"},
      {"name":"GP2GP_GPC_GET_TEST_URL",
"value": "${GP2GP_GPC_GET_TEST_URL}"},
      {"name":"GP2GP_LARGE_ATTACHMENT_THRESHOLD",
"value": "${GP2GP_LARGE_ATTACHMENT_THRESHOLD}"},
      {"name":"GP2GP_LARGE_EHR_EXTRACT_THRESHOLD",
"value": "${GP2GP_LARGE_EHR_EXTRACT_THRESHOLD}"},
      {"name":"GP2GP_MHS_INBOUND_QUEUE",
"value": "${GP2GP_MHS_INBOUND_QUEUE}"},

  mongodb:
    networks:
      {"name":"",
"value": "${}"},nia-daisy-chain
    image: ${MONGODB_VERSION}
    ports:
        {"name":"",
"value": "${}"},"27017:27017"

  gpcc:
    image: ${GPCC_ADAPTOR_VERSION}
    networks:
      {"name":"",
"value": "${}"},nia-daisy-chain
    ports:
      {"name":"",
"value": "${}"},"8090:8090"
    environment:
      {"name":"GPC_CONSUMER_LOGGING_LEVEL",
"value": "${GPC_CONSUMER_LOGGING_LEVEL}"},
      {"name":"GPC_CONSUMER_SERVER_PORT",
"value": "${GPC_CONSUMER_SERVER_PORT}"},
      {"name":"GPC_CONSUMER_SPINE_CLIENT_CERT",
"value": "${GPC_CONSUMER_SPINE_CLIENT_CERT}"},
      {"name":"GPC_CONSUMER_SPINE_CLIENT_KEY",
"value": "${GPC_CONSUMER_SPINE_CLIENT_KEY}"},
      {"name":"GPC_CONSUMER_SPINE_ROOT_CA_CERT",
"value": "${GPC_CONSUMER_SPINE_ROOT_CA_CERT}"},
      {"name":"GPC_CONSUMER_SPINE_SUB_CA_CERT",
"value": "${GPC_CONSUMER_SPINE_SUB_CA_CERT}"},
      {"name":"GPC_CONSUMER_SEARCH_DOCUMENTS_PATH",
"value": "${GPC_CONSUMER_SEARCH_DOCUMENTS_PATH}"},
      {"name":"GPC_CONSUMER_GPC_STRUCTURED_PATH",
"value": "${GPC_CONSUMER_GPC_STRUCTURED_PATH}"},
      {"name":"GPC_CONSUMER_GPC_GET_PATIENT_PATH",
"value": "${GPC_CONSUMER_GPC_GET_PATIENT_PATH}"},
      {"name":"GPC_CONSUMER_GPC_GET_DOCUMENT_PATH",
"value": "${GPC_CONSUMER_GPC_GET_DOCUMENT_PATH}"},
      {"name":"GPC_CONSUMER_SDS_URL",
"value": "${GPC_CONSUMER_SDS_URL}"},
      {"name":"GPC_CONSUMER_SDS_APIKEY",
"value": "${GPC_CONSUMER_SDS_APIKEY}"},
      {"name":"GPC_CONSUMER_SSP_URL",
"value": "${GPC_CONSUMER_SSP_URL}"},

  wiremock:
    networks:
      {"name":"",
"value": "${}"},nia-daisy-chain
    build: docker_gp2gp/wiremock
    ports:
      {"name":"",
"value": "${}"},"8110:8080"

  ########### LOCAL TESTING #################

  dynamodb:
    image: ${DYNAMODB_VERSION}
    networks:
      {"name":"",
"value": "${}"},nia-daisy-chain
    ports:
      {"name":"",
"value": "${}"},"8000:8000"

  redis:
    image: redis
    networks:
      {"name":"",
"value": "${}"},nia-daisy-chain
    ports:
      {"name":"",
"value": "${}"},"6379:6379"

  activemq:
    image: ${ACTIVEMQ_VERSION}
    ports:
      {"name":"",
"value": "${}"},"8161:8161"
      {"name":"",
"value": "${}"},"${ACTIVE_MQ_PORT}:5672"
    networks:
      {"name":"",
"value": "${}"},nia-daisy-chain